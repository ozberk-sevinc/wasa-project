openapi: 3.0.3
info:
  title: WASAText API
  version: "1.0.0"
  description: |
    Backend API for the WASAText messaging application.

    The app uses a very simple login flow:
    - You call POST /session with a username.
    - The server responds with a user identifier.
    - You send that identifier in the Authorization header as a Bearer token
      on all other requests.

    Usernames must be unique across the whole system.

servers:
  - url: http://localhost:3000
    description: Local development server

tags:
  - name: login
    description: Authentication and session management endpoints
  - name: me
    description: Current user profile management endpoints
  - name: users
    description: User search and listing endpoints
  - name: conversations
    description: Conversation listing and details endpoints
  - name: messages
    description: Message sending, forwarding, and reaction endpoints
  - name: groups
    description: Group chat management endpoints
  - name: health
    description: Health check and system status endpoints

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: user-identifier
      description: Bearer token authentication using user identifier

  schemas:
    # ==========================================================================
    # COMMON STRING PATTERNS (reusable)
    # ==========================================================================
    Identifier:
      type: string
      description: A unique identifier (UUID format).
      pattern: '^[a-zA-Z0-9_-]{1,64}$'
      minLength: 1
      maxLength: 64
      example: "abcdef012345"

    # ==========================================================================
    # CORE SCHEMAS
    # ==========================================================================
    Error:
      type: object
      description: A generic error payload returned when something goes wrong.
      properties:
        code:
          type: string
          description: Short machine-friendly error code.
          pattern: '^[a-z-]{1,32}$'
          minLength: 1
          maxLength: 32
          example: "conflict"
        message:
          type: string
          description: Human-readable explanation of what went wrong.
          pattern: '^.{1,500}$'
          minLength: 1
          maxLength: 500
          example: "That username is already taken."
      required:
        - code
        - message

    User:
      type: object
      description: A WASAText user. Usernames are unique in the whole system.
      properties:
        id:
          type: string
          description: Internal identifier of the user.
          pattern: '^[a-zA-Z0-9_-]{1,64}$'
          minLength: 1
          maxLength: 64
          example: "abcdef012345"
        name:
          type: string
          description: Unique username chosen by the user.
          pattern: '^[a-zA-Z0-9_]{3,16}$'
          minLength: 3
          maxLength: 16
          example: "Ozberk"
        displayName:
          type: string
          description: Optional friendly display name.
          pattern: '^.{0,50}$'
          minLength: 0
          maxLength: 50
          example: "√ñzberk Sevin√ß"
        photoUrl:
          type: string
          format: uri
          description: URL of the user's profile picture, if set.
          pattern: '^https?://.*$'
          minLength: 1
          maxLength: 2048
          example: "https://example.com/photo.jpg"
        lastSeenAt:
          type: string
          format: date-time
          description: ISO 8601 timestamp of when the user was last active. Null if user has never logged in or is currently offline.
          pattern: '^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d+)?(Z|[+-]\d{2}:\d{2})$'
          minLength: 20
          maxLength: 35
          example: "2025-01-01T12:00:00Z"
      required:
        - id
        - name

    ConversationSummary:
      type: object
      description: A short summary of a conversation shown in the conversations list.
      properties:
        id:
          type: string
          description: Identifier of the conversation.
          pattern: '^[a-zA-Z0-9_-]{1,64}$'
          minLength: 1
          maxLength: 64
          example: "abcdef012345"
        type:
          type: string
          enum: [direct, group]
          description: Whether this is a direct chat or a group chat.
        title:
          type: string
          description: For direct conversations the other user's username. For group conversations the group name.
          pattern: '^.{1,100}$'
          minLength: 1
          maxLength: 100
          example: "John Doe"
        photoUrl:
          type: string
          format: uri
          description: Optional conversation or group avatar.
          pattern: '^https?://.*$'
          minLength: 1
          maxLength: 2048
          example: "https://example.com/photo.jpg"
        lastMessageAt:
          type: string
          format: date-time
          description: When the last message in this conversation was sent.
          pattern: '^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d+)?(Z|[+-]\d{2}:\d{2})$'
          minLength: 20
          maxLength: 35
          example: "2025-01-01T12:00:00Z"
        lastMessageSnippet:
          type: string
          description: Short preview of the last message, or a placeholder like [photo] for non-text content.
          pattern: '^.{0,200}$'
          minLength: 0
          maxLength: 200
          example: "Hey, how are you?"
        lastMessageIsPhoto:
          type: boolean
          description: True if the most recent message is a photo.
      required:
        - id
        - type
        - title
        - lastMessageAt
        - lastMessageIsPhoto

    Reaction:
      type: object
      description: An emoji reaction to a message.
      properties:
        id:
          type: string
          description: Identifier of the reaction.
          pattern: '^[a-zA-Z0-9_-]{1,64}$'
          minLength: 1
          maxLength: 64
          example: "abcdef012345"
        emoji:
          type: string
          description: The emoji used for the reaction.
          pattern: '^.{1,10}$'
          minLength: 1
          maxLength: 10
          example: "üëç"
        user:
          $ref: '#/components/schemas/User'
        createdAt:
          type: string
          format: date-time
          description: When this reaction was added.
          pattern: '^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d+)?(Z|[+-]\d{2}:\d{2})$'
          minLength: 20
          maxLength: 35
          example: "2025-01-01T12:00:00Z"
      required:
        - id
        - emoji
        - user
        - createdAt

    Message:
      type: object
      description: A single message inside a conversation.
      properties:
        id:
          type: string
          description: Identifier of the message.
          pattern: '^[a-zA-Z0-9_-]{1,64}$'
          minLength: 1
          maxLength: 64
          example: "abcdef012345"
        conversationId:
          type: string
          description: Identifier of the conversation this message belongs to.
          pattern: '^[a-zA-Z0-9_-]{1,64}$'
          minLength: 1
          maxLength: 64
          example: "abcdef012345"
        sender:
          $ref: '#/components/schemas/User'
        createdAt:
          type: string
          format: date-time
          description: When the message was sent.
          pattern: '^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d+)?(Z|[+-]\d{2}:\d{2})$'
          minLength: 20
          maxLength: 35
          example: "2025-01-01T12:00:00Z"
        contentType:
          type: string
          enum: [text, photo]
          description: Type of the message content.
        text:
          type: string
          description: The text of the message, if contentType is text.
          pattern: '^[\s\S]{1,4096}$'
          minLength: 1
          maxLength: 4096
          example: "Hello, world!"
        photoUrl:
          type: string
          format: uri
          description: URL of the photo, if contentType is photo.
          pattern: '^https?://.*$'
          minLength: 1
          maxLength: 2048
          example: "https://example.com/photo.jpg"
        repliedToMessageId:
          type: string
          description: If this is a reply, the id of the message being replied to.
          pattern: '^[a-zA-Z0-9_-]{1,64}$'
          minLength: 1
          maxLength: 64
          example: "abcdef012345"
        status:
          type: string
          enum: [sent, received, read]
          description: |
            Delivery status of the message for the sender:
            - "sent" = Message sent but not yet received by recipient(s)
            - "received" = One checkmark - recipient(s) have received it in their conversation list
            - "read" = Two checkmarks - recipient(s) have opened and viewed the conversation
        reactions:
          type: array
          description: All reactions associated with this message.
          items:
            $ref: '#/components/schemas/Reaction'
          minItems: 0
          maxItems: 1000
      required:
        - id
        - conversationId
        - sender
        - createdAt
        - contentType
        - status
        - reactions

    Conversation:
      type: object
      description: A full conversation, including all participants and messages.
      properties:
        id:
          type: string
          description: Identifier of the conversation.
          pattern: '^[a-zA-Z0-9_-]{1,64}$'
          minLength: 1
          maxLength: 64
          example: "abcdef012345"
        type:
          type: string
          enum: [direct, group]
          description: Whether this is a direct chat or a group chat.
        title:
          type: string
          description: Other user's username (for direct) or the group name.
          pattern: '^.{1,100}$'
          minLength: 1
          maxLength: 100
          example: "Chat Group"
        photoUrl:
          type: string
          format: uri
          description: Optional conversation or group avatar.
          pattern: '^https?://.*$'
          minLength: 1
          maxLength: 2048
          example: "https://example.com/photo.jpg"
        participants:
          type: array
          description: Users that are part of this conversation.
          items:
            $ref: '#/components/schemas/User'
          minItems: 1
          maxItems: 256
        messages:
          type: array
          description: Messages in this conversation, usually shown in reverse-chronological order.
          items:
            $ref: '#/components/schemas/Message'
          minItems: 0
          maxItems: 10000
        lastMessage:
          description: The most recent message in this conversation (used in summary views).
          $ref: '#/components/schemas/Message'
        unreadCount:
          type: integer
          description: Number of messages in this conversation that the current user has not yet read.
          minimum: 0
          example: 3
      required:
        - id
        - type
        - title
        - participants
        - messages

    Group:
      type: object
      description: A group chat and its members.
      properties:
        id:
          type: string
          description: Identifier of the group.
          pattern: '^[a-zA-Z0-9_-]{1,64}$'
          minLength: 1
          maxLength: 64
          example: "abcdef012345"
        name:
          type: string
          description: Visible name of the group.
          pattern: '^.{1,100}$'
          minLength: 1
          maxLength: 100
          example: "Work Team"
        photoUrl:
          type: string
          format: uri
          description: Optional group avatar.
          pattern: '^https?://.*$'
          minLength: 1
          maxLength: 2048
          example: "https://example.com/photo.jpg"
        createdBy:
          type: string
          description: User ID of the group creator/admin who can manage group settings.
          pattern: '^[a-zA-Z0-9_-]{1,64}$'
          minLength: 1
          maxLength: 64
          example: "abcdef012345"
        members:
          type: array
          description: Users who are currently members of this group.
          items:
            $ref: '#/components/schemas/User'
          minItems: 1
          maxItems: 256
      required:
        - id
        - name
        - createdBy
        - members

    # ==========================================================================
    # REQUEST SCHEMAS
    # ==========================================================================
    SendMessageRequest:
      type: object
      description: Body used when sending a new message.
      properties:
        contentType:
          type: string
          enum: [text, photo]
          description: Whether this is a text message or a photo message.
        text:
          type: string
          description: Text content of the message when contentType is text.
          pattern: '^[\s\S]{1,4096}$'
          minLength: 1
          maxLength: 4096
          example: "Hello, world!"
        photoUrl:
          type: string
          format: uri
          description: URL of the photo when contentType is photo.
          pattern: '^https?://.*$'
          minLength: 1
          maxLength: 2048
          example: "https://example.com/photo.jpg"
        replyToMessageId:
          type: string
          description: Optional id of another message that this one replies to.
          pattern: '^[a-zA-Z0-9_-]{1,64}$'
          minLength: 1
          maxLength: 64
          example: "abcdef012345"
      required:
        - contentType

    CommentMessageRequest:
      type: object
      description: Body used when reacting to a message with an emoji.
      properties:
        emoji:
          type: string
          description: Emoji used as the reaction.
          pattern: '^.{1,10}$'
          minLength: 1
          maxLength: 10
          example: "üëç"
      required:
        - emoji

    ForwardMessageRequest:
      type: object
      description: Body used when forwarding a message to another conversation.
      properties:
        targetConversationId:
          type: string
          description: Id of the conversation that should receive the forwarded message.
          pattern: '^[a-zA-Z0-9_-]{1,64}$'
          minLength: 1
          maxLength: 64
          example: "abcdef012345"
      required:
        - targetConversationId

    CreateConversationRequest:
      type: object
      description: Body used when starting a new direct conversation with another user.
      properties:
        userId:
          type: string
          description: Id of the user to start a conversation with.
          pattern: '^[a-zA-Z0-9_-]{1,64}$'
          minLength: 1
          maxLength: 64
          example: "abcdef012345"
      required:
        - userId

    CreateGroupRequest:
      type: object
      description: Body used when creating a new group chat.
      properties:
        name:
          type: string
          description: Name of the group.
          pattern: '^.{1,100}$'
          minLength: 1
          maxLength: 100
          example: "New Group"
        memberIds:
          type: array
          description: List of user ids to add as initial members.
          items:
            $ref: '#/components/schemas/Identifier'
          minItems: 0
          maxItems: 255
      required:
        - name

    AddToGroupRequest:
      type: object
      description: Body used when adding a user to an existing group.
      properties:
        userId:
          type: string
          description: Id of the user to add to the group.
          pattern: '^[a-zA-Z0-9_-]{1,64}$'
          minLength: 1
          maxLength: 64
          example: "abcdef012345"
      required:
        - userId

    SetGroupNameRequest:
      type: object
      description: Body used when renaming a group.
      properties:
        name:
          type: string
          description: New name for the group.
          pattern: '^.{1,100}$'
          minLength: 1
          maxLength: 100
          example: "Renamed Group"
      required:
        - name

    SetMyUserNameRequest:
      type: object
      description: Body used when changing the current user's username.
      properties:
        name:
          type: string
          description: New username; must be globally unique.
          pattern: '^[a-zA-Z0-9_]{3,16}$'
          minLength: 3
          maxLength: 16
          example: "Ozberk"
      required:
        - name

    SearchUsersResponse:
      type: object
      description: Response returned when searching for users.
      properties:
        users:
          type: array
          description: Users that match the search criteria (or all users if no search was provided).
          items:
            $ref: '#/components/schemas/User'
          minItems: 0
          maxItems: 1000
      required:
        - users

    LoginRequest:
      type: object
      description: Body used when logging in or registering with a username.
      properties:
        name:
          type: string
          description: Username for login or registration.
          pattern: '^[a-zA-Z0-9_]{3,16}$'
          minLength: 3
          maxLength: 16
          example: "Ozberk"
      required:
        - name

    LoginResponse:
      type: object
      description: Response returned after successful login.
      properties:
        identifier:
          type: string
          description: Opaque identifier to be used as a Bearer token.
          pattern: '^[a-zA-Z0-9_-]{1,64}$'
          minLength: 1
          maxLength: 64
          example: "abcdef012345"
      required:
        - identifier

security:
  - BearerAuth: []

paths:

  #########
  # Simplified login (no password)  #
  #########
  /session:
    post:
      tags: ["login"]
      summary: Log in or register with a username
      description: |
        Logs in a user using only a username.

        - If the username does not exist yet, a new user is created.
        - If it already exists, that existing user is reused.

        The response returns an identifier. You must send this identifier as:

        Authorization: Bearer <identifier>

        in all other requests.
      operationId: doLogin
      security: []   # no auth for login
      requestBody:
        required: true
        description: Username details for logging in.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '201':
          description: Login succeeded; identifier returned.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '400':
          description: The provided username is not valid (for example, too short or too long).
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  # Current user  #
  /me:
    get:
      tags: ["me"]
      summary: Get information about the current user
      description: Returns the profile of the user associated with the provided identifier.
      operationId: getMe
      responses:
        '200':
          description: Current user profile.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: Authorization header is missing or the identifier is invalid.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /me/username:
    put:
      tags: ["me"]
      summary: Change my username
      description: |
        Updates the current user's username.

        The new username must be unique. If someone else is already using it,
        the request will fail with a 409 response.
      operationId: setMyUserName
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SetMyUserNameRequest'
      responses:
        '200':
          description: Username updated successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: The new username is invalid (for example, wrong length).
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Another user is already using that username.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /me/photo:
    put:
      tags: ["me"]
      summary: Upload or change my profile photo
      description: Sets or updates the current user's profile picture.
      operationId: setMyPhoto
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              description: Multipart form containing the photo file.
              properties:
                photo:
                  type: string
                  format: binary
                  description: Image file to be used as the new profile photo.
                  minLength: 1
                  maxLength: 10485760
              required:
                - photo
      responses:
        '200':
          description: Profile photo updated successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: The uploaded image could not be processed.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  # Users (search)
  /users:
    get:
      tags: ["users"]
      summary: List or search users
      description: |
        Returns a list of users.

        - If no query is provided, all users may be returned.
        - If a query string is provided, only users matching that query are returned.
      operationId: searchUsers
      parameters:
        - in: query
          name: q
          schema:
            type: string
            description: Search keyword to match usernames.
            pattern: '^.{0,100}$'
            minLength: 0
            maxLength: 100
          required: false
          description: Optional search keyword to match usernames.
      responses:
        '200':
          description: Users matching the search criteria.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchUsersResponse'

  
  # Conversations & messages
  /conversations:
    post:
      tags: ["conversations"]
      summary: Start a new direct conversation
      description: |
        Creates a new direct (one-to-one) conversation with another user.

        If a direct conversation with this user already exists, returns that existing conversation.
        The new conversation automatically appears in both users' conversation lists.
      operationId: startConversation
      requestBody:
        required: true
        description: Details of the user to start a conversation with.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateConversationRequest'
      responses:
        '201':
          description: New conversation created successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Conversation'
        '200':
          description: A direct conversation with this user already exists; returning the existing one.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Conversation'
        '400':
          description: Invalid request (e.g., trying to start a conversation with yourself).
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: The target user does not exist.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    get:
      tags: ["conversations"]
      summary: Get my conversations
      description: |
        Returns all conversations that the current user is part of.

        The list is sorted so that conversations with the most recent activity appear first.
        Viewing this list marks messages from other users as "received" (one checkmark).
      operationId: getMyConversations
      responses:
        '200':
          description: List of conversation summaries.
          content:
            application/json:
              schema:
                type: array
                description: List of conversation summaries for the current user.
                items:
                  $ref: '#/components/schemas/ConversationSummary'
                minItems: 0
                maxItems: 1000

  /conversations/{conversationId}:
    get:
      tags: ["conversations"]
      summary: Get a conversation and its messages
      description: |
        Returns full details for a single conversation, including its messages.
        Viewing this conversation marks messages from other users as "read" (two checkmarks).
      operationId: getConversation
      parameters:
        - in: path
          name: conversationId
          required: true
          schema:
            $ref: '#/components/schemas/Identifier'
          description: Id of the conversation to retrieve.
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
          required: false
          description: Maximum number of messages to return. Defaults to 50.
        - in: query
          name: offset
          schema:
            type: integer
            minimum: 0
            default: 0
          required: false
          description: Number of messages to skip for pagination. Defaults to 0.
        - in: query
          name: beforeMessageId
          schema:
            $ref: '#/components/schemas/Identifier'
          required: false
          description: Optional message ID to fetch messages before (for cursor-based pagination).
      responses:
        '200':
          description: Conversation details.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Conversation'
        '404':
          description: The conversation does not exist or the user is not a participant.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /conversations/{conversationId}/messages:
    post:
      tags: ["messages"]
      summary: Send a message in a conversation
      description: |
        Sends a new message inside the specified conversation.

        For a first message between two users, this effectively creates the conversation.
      operationId: sendMessage
      parameters:
        - in: path
          name: conversationId
          required: true
          schema:
            $ref: '#/components/schemas/Identifier'
          description: Id of the conversation that should receive the message.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SendMessageRequest'
      responses:
        '201':
          description: Message created and stored successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Message'
        '404':
          description: The conversation could not be found or the user is not a participant.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /conversations/{conversationId}/photos:
    post:
      tags: ["messages"]
      summary: Upload a photo for a message
      description: |
        Uploads a photo to the specified conversation. Returns the URL of the
        uploaded photo, which can then be used when sending a photo message.
      operationId: uploadMessagePhoto
      parameters:
        - in: path
          name: conversationId
          required: true
          schema:
            $ref: '#/components/schemas/Identifier'
          description: Id of the conversation the photo belongs to.
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              description: Multipart form containing the photo file.
              properties:
                photo:
                  type: string
                  format: binary
                  description: Image file to upload.
                  minLength: 1
                  maxLength: 10485760
              required:
                - photo
      responses:
        '200':
          description: Photo uploaded successfully; URL returned.
          content:
            application/json:
              schema:
                type: object
                description: Object containing the URL of the uploaded photo.
                properties:
                  photoUrl:
                    type: string
                    description: Relative URL path to the uploaded photo.
                    pattern: '^/uploads/.*$'
                    minLength: 1
                    maxLength: 2048
                    example: "/uploads/messages/abc123/photo.jpg"
                required:
                  - photoUrl
        '400':
          description: The uploaded file is missing or invalid.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: The conversation does not exist or the user is not a participant.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /conversations/{conversationId}/messages/{messageId}:
    delete:
      tags: ["messages"]
      summary: Delete one of my messages
      description: Removes a message that was previously sent by the current user.
      operationId: deleteMessage
      parameters:
        - in: path
          name: conversationId
          required: true
          schema:
            $ref: '#/components/schemas/Identifier'
          description: Id of the conversation the message belongs to.
        - in: path
          name: messageId
          required: true
          schema:
            $ref: '#/components/schemas/Identifier'
          description: Id of the message to delete.
      responses:
        '204':
          description: Message deleted successfully.
        '403':
          description: The current user is not allowed to delete this message (not the sender).
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: The message could not be found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /conversations/{conversationId}/messages/{messageId}/forward:
    post:
      tags: ["messages"]
      summary: Forward a message to another conversation
      description: Creates a new message in another conversation with the content of the original message.
      operationId: forwardMessage
      parameters:
        - in: path
          name: conversationId
          required: true
          schema:
            $ref: '#/components/schemas/Identifier'
          description: Id of the conversation the original message belongs to.
        - in: path
          name: messageId
          required: true
          schema:
            $ref: '#/components/schemas/Identifier'
          description: Id of the message to forward.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ForwardMessageRequest'
      responses:
        '201':
          description: Message forwarded and created in the target conversation.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Message'
        '404':
          description: The original message or the target conversation could not be found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /conversations/{conversationId}/messages/{messageId}/comments:
    post:
      tags: ["messages"]
      summary: React to a message with an emoji
      description: Adds an emoji reaction to a message.
      operationId: commentMessage
      parameters:
        - in: path
          name: conversationId
          required: true
          schema:
            $ref: '#/components/schemas/Identifier'
          description: Id of the conversation the message belongs to.
        - in: path
          name: messageId
          required: true
          schema:
            $ref: '#/components/schemas/Identifier'
          description: Id of the message to react to.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CommentMessageRequest'
      responses:
        '201':
          description: Reaction added successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Reaction'
        '404':
          description: The message could not be found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /conversations/{conversationId}/messages/{messageId}/comments/{commentId}:
    delete:
      tags: ["messages"]
      summary: Remove one of my emoji reactions
      description: Deletes a reaction previously added by the current user.
      operationId: uncommentMessage
      parameters:
        - in: path
          name: conversationId
          required: true
          schema:
            $ref: '#/components/schemas/Identifier'
          description: Id of the conversation the message belongs to.
        - in: path
          name: messageId
          required: true
          schema:
            $ref: '#/components/schemas/Identifier'
          description: Id of the message the reaction is attached to.
        - in: path
          name: commentId
          required: true
          schema:
            $ref: '#/components/schemas/Identifier'
          description: Id of the reaction to remove.
      responses:
        '204':
          description: Reaction removed successfully.
        '403':
          description: The current user is not the author of this reaction.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: The reaction could not be found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  # Groups   #
  /groups:
    post:
      tags: ["groups"]
      summary: Create a new group chat
      description: Creates a new group conversation and optionally adds initial members.
      operationId: createGroup
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateGroupRequest'
      responses:
        '201':
          description: Group created successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Group'

  /groups/{groupId}:
    get:
      tags: ["groups"]
      summary: Get details about a group
      description: Returns information about a specific group, including its members.
      operationId: getGroup
      parameters:
        - in: path
          name: groupId
          required: true
          schema:
            $ref: '#/components/schemas/Identifier'
          description: Id of the group to retrieve.
      responses:
        '200':
          description: Group details.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Group'
        '404':
          description: The group does not exist or the user is not a member.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /groups/{groupId}/members:
    post:
      tags: ["groups"]
      summary: Add a user to a group
      description: |
        Adds a user to the specified group.

        Any member of the group is allowed to add other users.
      operationId: addToGroup
      parameters:
        - in: path
          name: groupId
          required: true
          schema:
            $ref: '#/components/schemas/Identifier'
          description: Id of the group to update.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddToGroupRequest'
      responses:
        '200':
          description: User successfully added to the group.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Group'
        '404':
          description: The group or user could not be found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /groups/{groupId}/members/me:
    delete:
      tags: ["groups"]
      summary: Leave a group
      description: Removes the current user from the specified group.
      operationId: leaveGroup
      parameters:
        - in: path
          name: groupId
          required: true
          schema:
            $ref: '#/components/schemas/Identifier'
          description: Id of the group to leave.
      responses:
        '204':
          description: The user left the group successfully.
        '404':
          description: The group does not exist or the user is not a member.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /groups/{groupId}/name:
    put:
      tags: ["groups"]
      summary: Change the name of a group
      description: Updates the display name of a group.
      operationId: setGroupName
      parameters:
        - in: path
          name: groupId
          required: true
          schema:
            $ref: '#/components/schemas/Identifier'
          description: Id of the group to rename.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SetGroupNameRequest'
      responses:
        '200':
          description: Group name updated successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Group'
        '404':
          description: The group does not exist or the user is not a member.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /groups/{groupId}/photo:
    put:
      tags: ["groups"]
      summary: Change the group photo
      description: Sets or updates the avatar image for a group.
      operationId: setGroupPhoto
      parameters:
        - in: path
          name: groupId
          required: true
          schema:
            $ref: '#/components/schemas/Identifier'
          description: Id of the group to update.
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              description: Multipart form containing the photo file.
              properties:
                photo:
                  type: string
                  format: binary
                  description: Image file to be used as the new group photo.
                  minLength: 1
                  maxLength: 10485760
              required:
                - photo
      responses:
        '200':
          description: Group photo updated successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Group'
        '404':
          description: The group does not exist or the user is not a member.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /liveness:
    get:
      summary: Health check endpoint
      description: Returns a simple health status for orchestration systems (Docker, Kubernetes).
      operationId: getLiveness
      tags:
        - health
      security: []  # No authentication required
      responses:
        '200':
          description: Service is alive and operational.
          content:
            text/plain:
              schema:
                type: string
                description: Health check status message.
                example: "OK"
